"use strict";const t=1e-6;class s{static fromObject(t){return new s(t.x,t.y)}static fromArray(t){return new s(t[0],t[1])}constructor(t=0,s=0){this.x=t,this.y=s}*[Symbol.iterator](){yield this.x,yield this.y}clone(){return new s(this.x,this.y)}toObject(){return{x:this.x,y:this.y}}toArray(){return[this.x,this.y]}distance(t){const s=t.x-this.x,i=t.y-this.y;return Math.sqrt(s*s+i*i)}magnitudeSquared(){return this.x*this.x+this.y*this.y}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}dot(t){return this.x*t.x+this.y*t.y}apply(t){return this.x=t(this.x),this.y=t(this.y),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,s){return this.x=c(this.x,t.x,s.x),this.y=c(this.y,t.y,s.y),this}neg(){return this.x=-this.x,this.y=-this.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}sub(t){return this.x-=t.x,this.y-=t.y,this}mul(t){return this.x*=t.x,this.y*=t.y,this}div(t){return this.x/=t.x,this.y/=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}subScalar(t){return this.x-=t,this.y-=t,this}mulScalar(t){return this.x*=t,this.y*=t,this}divScalar(t){return this.x/=t,this.y/=t,this}setLength(t){const s=this.x*this.x+this.y*this.y;if(0===s)return this.x=this.y=0,this;const i=t/Math.sqrt(s);return this.x*=i,this.y*=i,this}normalize(){const t=this.x*this.x+this.y*this.y;if(0===t)return this.x=this.y=0,this;const s=1/Math.sqrt(t);return this.x*=s,this.y*=s,this}transformMatrix4(t){const s=this.x,i=this.y;return this.x=s*t.m00+i*t.m10+t.m20,this.y=s*t.m01+i*t.m11+t.m21,this}transformMatrix3(t){const s=this.x,i=this.y;return this.x=s*t.m00+i*t.m10+t.m20,this.y=s*t.m01+i*t.m11+t.m21,this}transformMatrix2(t){const s=this.x,i=this.y;return this.x=s*t.m00+i*t.m10,this.y=s*t.m01+i*t.m11,this}cross(){return this.x*this.y-this.y*this.x}set(t,s){return this.x=t,this.y=s,this}copy(t){return this.x=t.x,this.y=t.y,this}addScaledVector(t,s){return this.x+=t.x*s,this.y+=t.y*s,this}subScaledVector(t,s){return this.x-=t.x*s,this.y-=t.y*s,this}negVector(t){return this.x=-t.x,this.y=-t.y,this}addVectors(t,s){return this.x=t.x+s.x,this.y=t.y+s.y,this}subVectors(t,s){return this.x=t.x-s.x,this.y=t.y-s.y,this}mulVectors(t,s){return this.x=t.x*s.x,this.y=t.y*s.y,this}divVectors(t,s){return this.x=t.x/s.x,this.y=t.y/s.y,this}lerpVectors(t,s,i=0){return this.x=(s.x-t.x)*i+t.x,this.y=(s.y-t.y)*i+t.y,this}}class i{static fromObject(t){return new i(t.x,t.y,t.z)}static fromArray(t){return new i(t[0],t[1],t[2])}constructor(t=0,s=0,i=0){this.x=t,this.y=s,this.z=i}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}clone(){return new i(this.x,this.y,this.z)}toObject(){return{x:this.x,y:this.y,z:this.z}}toArray(){return[this.x,this.y,this.z]}distance(t){const s=t.x-this.x,i=t.y-this.y,e=t.z-this.z;return Math.sqrt(s*s+i*i+e*e)}magnitudeSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}apply(t){return this.x=t(this.x),this.y=t(this.y),this.z=t(this.z),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,s){return this.x=c(this.x,t.x,s.x),this.y=c(this.y,t.y,s.y),this.z=c(this.z,t.z,s.z),this}neg(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}mul(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}div(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}mulScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}divScalar(t){return this.x/=t,this.y/=t,this.z/=t,this}setLength(t){const s=this.x,i=this.y,e=this.z,h=s*s+i*i+e*e;if(0==h)return this.x=this.y=this.z=0,this;const n=t/Math.sqrt(h);return this.x=s*n,this.y=i*n,this.z=e*n,this}normalize(){const t=this.x,s=this.y,i=this.z,e=t*t+s*s+i*i;if(0!==e){const h=1/Math.sqrt(e);return this.x=t*h,this.y=s*h,this.z=i*h,this}return this.x=this.y=this.z=0,this}transformMatrix3(t){const s=this.x,i=this.y,e=this.z;return this.x=s*t.m00+i*t.m10+e*t.m20,this.y=s*t.m01+i*t.m11+e*t.m21,this.z=s*t.m02+i*t.m12+e*t.m22,this}transformMatrix4(t){const s=this.x,i=this.y,e=this.z;return this.x=s*t.m00+i*t.m10+e*t.m20+t.m30,this.y=s*t.m01+i*t.m11+e*t.m21+t.m31,this.z=s*t.m02+i*t.m12+e*t.m22+t.m32,this}cross(t){const s=this.x,i=this.y,e=this.z,h=t.x,n=t.y,m=t.z;return this.x=i*m-n*e,this.y=e*h-m*s,this.z=s*n-h*i,this}set(t,s,i){return this.x=t,this.y=s,this.z=i,this}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}addScaledVector(t,s){return this.x+=t.x*s,this.y+=t.y*s,this.z+=t.z*s,this}subScaledVector(t,s){return this.x-=t.x*s,this.y-=t.y*s,this.z-=t.z*s,this}negVector(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this}addVectors(t,s){return this.x=t.x+s.x,this.y=t.y+s.y,this.z=t.z+s.z,this}subVectors(t,s){return this.x=t.x-s.x,this.y=t.y-s.y,this.z=t.z-s.z,this}mulVectors(t,s){return this.x=t.x*s.x,this.y=t.y*s.y,this.z=t.z*s.z,this}divVectors(t,s){return this.x=t.x/s.x,this.y=t.y/s.y,this.z=t.z/s.z,this}lerpVectors(t,s,i=0){const e=t.x,h=t.y,n=t.z,m=s.x,a=s.y,r=s.z;return this.x=(m-e)*i+e,this.y=(a-h)*i+h,this.z=(r-n)*i+n,this}crossVectors(t,s){const i=t.x,e=t.y,h=t.z,n=s.x,m=s.y,a=s.z;return this.x=e*a-m*h,this.y=h*n-a*i,this.z=i*m-n*e,this}}class e{static fromObject(t){return new e(t.x,t.y,t.z,t.w)}static fromArray(t){return new e(t[0],t[1],t[2],t[3])}constructor(t=0,s=0,i=0,e=1){this.x=t,this.y=s,this.z=i,this.w=e}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}clone(){return new e(this.x,this.y,this.z,this.w)}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}toArray(){return[this.x,this.y,this.z,this.w]}distance(t){const s=t.x-this.x,i=t.y-this.y,e=t.z-this.z;return Math.sqrt(s*s+i*i+e*e)}magnitudeSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}apply(t){return this.x=t(this.x),this.y=t(this.y),this.z=t(this.z),this.w=t(this.w),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,s){return this.x=c(this.x,t.x,s.x),this.y=c(this.y,t.y,s.y),this.z=c(this.z,t.z,s.z),this.w=c(this.w,t.w,s.w),this}neg(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}mul(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}div(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}mulScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}divScalar(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this}setLength(t){const s=this.x*this.x+this.y*this.y+this.z*this.z;if(0===s)return this.x=0,this.y=0,this.z=0,this.w=1,this;const i=t/Math.sqrt(s);return this.x*=i,this.y*=i,this.z*=i,this.w*=i,this}normalize(){const t=this.x*this.x+this.y*this.y+this.z*this.z;if(0===t)return this.x=0,this.y=0,this.z=0,this.w=1,this;const s=1/Math.sqrt(t);return this.x*=s,this.y*=s,this.z*=s,this.w*=s,this}transformMatrix4(t){const s=this.x,i=this.y,e=this.z,h=this.w;return this.x=s*t.m00+i*t.m10+e*t.m20+h*t.m30,this.y=s*t.m01+i*t.m11+e*t.m21+h*t.m31,this.z=s*t.m02+i*t.m12+e*t.m22+h*t.m32,this.w=s*t.m03+i*t.m13+e*t.m23+h*t.m33,this}cross(t){const s=this.x,i=this.y,e=this.z,h=this.w,n=t.x,m=t.y,a=t.z;return t.w,this.x=i*a-m*e,this.y=e*n-a*s,this.z=s*m-n*i,this.w=h,this}set(t,s,i,e){return this.x=t,this.y=s,this.z=i,this.w=e,this}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}addScaledVector(t,s){return this.x+=t.x*s,this.y+=t.y*s,this.z+=t.z*s,this.w+=t.w*s,this}subScaledVector(t,s){return this.x-=t.x*s,this.y-=t.y*s,this.z-=t.z*s,this.w-=t.w*s,this}negVector(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this.w=-t.w,this}addVectors(t,s){return this.x=t.x+s.x,this.y=t.y+s.y,this.z=t.z+s.z,this.w=t.w+s.w,this}subVectors(t,s){return this.x=t.x-s.x,this.y=t.y-s.y,this.z=t.z-s.z,this.w=t.w-s.w,this}mulVectors(t,s){return this.x=t.x*s.x,this.y=t.y*s.y,this.z=t.z*s.z,this.w=t.w*s.w,this}divVectors(t,s){return this.x=t.x/s.x,this.y=t.y/s.y,this.z=t.z/s.z,this.w=t.w/s.w,this}lerpVectors(t,s,i=0){return this.x=(s.x-t.x)*i+t.x,this.y=(s.y-t.y)*i+t.y,this.z=(s.z-t.z)*i+t.z,this.w=(s.w-t.w)*i+t.w,this}crossVectors(t,s){const i=t.x,e=t.y,h=t.z,n=t.w,m=s.x,a=s.y,r=s.z;return s.w,this.x=e*r-a*h,this.y=h*m-r*i,this.z=i*a-m*e,this.w=n,this}}class h{constructor(t=0,s=0,i=0,e=0){this.min_x=t,this.max_x=i,this.min_y=s,this.max_y=e}clone(){return new h(this.min_x,this.min_y,this.max_x,this.max_y)}set(t=0,s=0,i=0,e=0){return this.min_x=t,this.max_x=i,this.min_y=s,this.max_y=e,this}copy(t){return this.min_x=t.min_x,this.max_x=t.max_x,this.min_y=t.min_y,this.max_y=t.max_y,this}grow(t){return this.min_x-=t,this.min_y-=t,this.max_x+=t,this.max_y+=t,this}mul(t){return this.min_x*=t,this.min_y*=t,this.max_x*=t,this.max_y*=t,this}transformMatrix2(t){const s=t.m00,i=t.m01,e=t.m10,h=t.m11,n=s*this.min_x,m=i*this.min_x,a=s*this.max_x,r=i*this.max_x,o=e*this.min_y,c=h*this.min_y,l=e*this.max_y,x=h*this.max_y,d=Math.min(n,a),u=Math.min(m,r),_=Math.max(n,a),y=Math.max(m,r),p=Math.min(o,l),z=Math.min(c,x),M=Math.max(o,l),f=Math.max(c,x);return this.min_x=d+p,this.min_y=u+z,this.max_x=_+M,this.max_y=y+f,this}transformMatrix3(t){const s=t.m00,i=t.m01,e=t.m10,h=t.m11,n=t.m20,m=t.m21,a=s*this.min_x,r=i*this.min_x,o=s*this.max_x,c=i*this.max_x,l=e*this.min_y,x=h*this.min_y,d=e*this.max_y,u=h*this.max_y,_=Math.min(a,o),y=Math.min(r,c),p=Math.max(a,o),z=Math.max(r,c),M=Math.min(l,d),f=Math.min(x,u),w=Math.max(l,d),g=Math.max(x,u);return this.min_x=_+M+n,this.min_y=y+f+m,this.max_x=p+w+n,this.max_y=z+g+m,this}unionBoxes(t,s){return this.min_x=Math.min(t.min_x,s.min_x),this.min_y=Math.min(t.min_y,s.min_y),this.max_x=Math.max(t.max_x,s.max_x),this.max_y=Math.max(t.max_y,s.max_y),this}intersectBoxes(t,s){return this.min_x=Math.max(t.min_x,s.min_x),this.min_y=Math.max(t.min_y,s.min_y),this.max_x=Math.min(t.max_x,s.max_x),this.max_y=Math.min(t.max_y,s.max_y),this}union(t){return this.unionBoxes(this,t)}intersect(t){return this.intersectBoxes(this,t)}}class n{constructor(t=0,s=0,i=0,e=0,h=0,n=0){this.min_x=t,this.min_y=s,this.min_z=i,this.max_x=e,this.max_y=h,this.max_z=n}clone(){return new n(this.min_x,this.min_y,this.min_z,this.max_x,this.max_y,this.max_z)}set(t=0,s=0,i=0,e=0,h=0,n=0){return this.min_x=t,this.min_y=s,this.min_z=i,this.max_x=e,this.max_y=h,this.max_z=n,this}copy(t){return this.min_x=t.min_x,this.min_y=t.min_y,this.min_z=t.min_z,this.max_x=t.max_x,this.max_y=t.max_y,this.max_z=t.max_z,this}grow(t){return this.min_x-=t,this.min_y-=t,this.min_z-=t,this.max_x+=t,this.max_y+=t,this.max_z+=t,this}mul(t){return this.min_x*=t,this.min_y*=t,this.min_z*=t,this.max_x*=t,this.max_y*=t,this.max_z*=t,this}transformMatrix3(t){const s=t.m00,i=t.m01,e=t.m02,h=t.m10,n=t.m11,m=t.m12,a=t.m20,r=t.m21,o=t.m22,c=s*this.min_x,l=i*this.min_x,x=e*this.min_x,d=s*this.max_x,u=i*this.max_x,_=e*this.max_x,y=h*this.min_y,p=n*this.min_y,z=m*this.min_y,M=h*this.max_y,f=n*this.max_y,w=m*this.max_y,g=a*this.min_z,b=r*this.min_z,S=o*this.min_z,D=a*this.max_z,F=r*this.max_z,k=o*this.max_z,v=Math.min(c,d),E=Math.min(l,u),q=Math.min(x,_),V=Math.max(c,d),X=Math.max(l,u),Y=Math.max(x,_),Z=Math.min(y,M),O=Math.min(p,f),B=Math.min(z,w),I=Math.max(y,M),T=Math.max(p,f),P=Math.max(z,w),C=Math.min(g,D),U=Math.min(b,F),A=Math.min(S,k),L=Math.max(g,D),j=Math.max(b,F),N=Math.max(S,k);return this.min_x=v+Z+C,this.min_y=E+O+U,this.min_z=q+B+A,this.max_x=V+I+L,this.max_y=X+T+j,this.max_z=Y+P+N,this}transformMatrix4(t){const s=t.m00,i=t.m01,e=t.m02,h=t.m10,n=t.m11,m=t.m12,a=t.m20,r=t.m21,o=t.m22,c=t.m30,l=t.m31,x=t.m32,d=s*this.min_x,u=i*this.min_x,_=e*this.min_x,y=s*this.max_x,p=i*this.max_x,z=e*this.max_x,M=h*this.min_y,f=n*this.min_y,w=m*this.min_y,g=h*this.max_y,b=n*this.max_y,S=m*this.max_y,D=a*this.min_z,F=r*this.min_z,k=o*this.min_z,v=a*this.max_z,E=r*this.max_z,q=o*this.max_z,V=Math.min(d,y),X=Math.min(u,p),Y=Math.min(_,z),Z=Math.max(d,y),O=Math.max(u,p),B=Math.max(_,z),I=Math.min(M,g),T=Math.min(f,b),P=Math.min(w,S),C=Math.max(M,g),U=Math.max(f,b),A=Math.max(w,S),L=Math.min(D,v),j=Math.min(F,E),N=Math.min(k,q),$=Math.max(D,v),G=Math.max(F,E),Q=Math.max(k,q);return this.min_x=V+I+L+c,this.min_y=X+T+j+l,this.min_z=Y+P+N+x,this.max_x=Z+C+$+c,this.max_y=O+U+G+l,this.max_z=B+A+Q+x,this}unionBoxes(t,s){return this.min_x=Math.min(t.min_x,s.min_x),this.min_y=Math.min(t.min_y,s.min_y),this.min_z=Math.min(t.min_z,s.min_z),this.max_x=Math.max(t.max_x,s.max_x),this.max_y=Math.max(t.max_y,s.max_y),this.max_z=Math.max(t.max_z,s.max_z),this}intersectBoxes(t,s){return this.min_x=Math.max(t.min_x,s.min_x),this.min_y=Math.max(t.min_y,s.min_y),this.min_z=Math.max(t.min_z,s.min_z),this.max_x=Math.min(t.max_x,s.max_x),this.max_y=Math.min(t.max_y,s.max_y),this.max_z=Math.min(t.max_z,s.max_z),this}union(t){return this.unionBoxes(this,t)}intersect(t){return this.intersectBoxes(this,t)}}class m{constructor(t,s,i,e){this.normal_x=t,this.normal_y=s,this.normal_z=i,this.distance=e}getOrigin(t=new i){return t.set(this.normal_x*this.distance,this.normal_y*this.distance,this.normal_z*this.distance)}getNormal(t=new i){return t.set(this.normal_x,this.normal_y,this.normal_z)}clone(){return new m(this.normal_x,this.normal_y,this.normal_z,this.distance)}dotPlane(t){return this.normal_x*t.normal_x+this.normal_y*t.normal_y+this.normal_z*t.normal_z}dotVector(t){return this.normal_x*t.x+this.normal_y*t.y+this.normal_z*t.z}copy(t){return this.normal_x=t.normal_x,this.normal_y=t.normal_y,this.normal_z=t.normal_z,this.distance=t.distance,this}equals(s){const i=s.normal_x-this.normal_x,e=s.normal_y-this.normal_y,h=s.normal_z-this.normal_z,n=Math.abs(this.distance-s.distance),m=Math.sqrt(i*i+e*e+h*h);return n<=t&&m<=t}flip(){return this.normal_x=-this.normal_x,this.normal_y=-this.normal_y,this.normal_z=-this.normal_z,this.distance=-this.distance,this}distanceToPoint(t,s,i){return t*this.normal_x+s*this.normal_y+i*this.normal_z-this.distance}projectionOfPoint(t,s,e){const h=t*this.normal_x+s*this.normal_y+e*this.normal_z-this.distance;return new i(t-h*this.normal_x,s-h*this.normal_y,e-h*this.normal_z)}transformMatrix3(t,s){const i=this.normal_x,e=this.normal_y,h=this.normal_z,n=this.distance,m=i*n*t.m00+e*n*t.m10+h*n*t.m20,a=i*n*t.m01+e*n*t.m11+h*n*t.m21,r=i*n*t.m02+e*n*t.m12+h*n*t.m22,o=i*s.m00+e*s.m10+h*s.m20,c=i*s.m01+e*s.m11+h*s.m21,l=i*s.m02+e*s.m12+h*s.m22,x=o*m+c*a+l*r;return this.normal_x=o,this.normal_y=c,this.normal_z=l,this.distance=x,this}transformMatrix4(t,s){const i=this.normal_x,e=this.normal_y,h=this.normal_z,n=this.distance,m=i*n*t.m00+e*n*t.m10+h*n*t.m20+t.m30,a=i*n*t.m01+e*n*t.m11+h*n*t.m21+t.m31,r=i*n*t.m02+e*n*t.m12+h*n*t.m22+t.m32,o=i*s.m00+e*s.m10+h*s.m20,c=i*s.m01+e*s.m11+h*s.m21,l=i*s.m02+e*s.m12+h*s.m22,x=o*m+c*a+l*r;return this.normal_x=o,this.normal_y=c,this.normal_z=l,this.distance=x,this}fromNormalAndPoint(t,s,i,e,h,n){const m=t*e+s*h+i*n;return this.normal_x=t,this.normal_y=s,this.normal_z=i,this.distance=m,this}fromPoints(t,s,i,e,h,n,a,r,o){const c=e-t,l=h-s,x=n-i,d=a-t,u=r-s,_=o-i,y=l*_-u*x,p=x*d-_*c,z=c*u-d*l,M=y*y+p*p+z*z;if(0===M)return new m(0,0,0,0);const f=1/Math.sqrt(M),w=y*f,g=p*f,b=z*f,S=w*t+g*s+b*i;return this.normal_x=w,this.normal_y=g,this.normal_z=b,this.distance=S,this}fromVectors(t,s,i){return this.fromPoints(t.x,t.y,t.z,s.x,s.y,s.z,i.x,i.y,i.z)}}class a{static identity(){return new a(1,0,0,1)}static scale(t,s){return new a(t,0,0,s)}static rotate(t){const s=Math.cos(t),i=Math.sin(t);return new a(s,-i,i,s)}constructor(t=1,s=0,i=0,e=1){this.m00=t,this.m01=i,this.m10=s,this.m11=e}clone(){return new a(this.m00,this.m10,this.m01,this.m11)}determinant(){return this.m00*this.m11-this.m10*this.m01}isIdentity(){return 1===this.m00&&0===this.m01&&0===this.m10&&1===this.m11}equals(s){return Math.abs(this.m00-s.m00)<=t&&Math.abs(this.m10-s.m10)<=t&&Math.abs(this.m01-s.m01)<=t&&Math.abs(this.m11-s.m11)<=t}identity(){return this.m00=1,this.m01=0,this.m10=0,this.m11=1,this}set(t,s,i,e){return this.m00=t,this.m01=s,this.m10=i,this.m11=e,this}copy(t){return this.m00=t.m00,this.m01=t.m01,this.m10=t.m10,this.m11=t.m11,this}transposeMatrix(t){const s=t.m00,i=t.m01,e=t.m10,h=t.m11;return this.m00=s,this.m01=e,this.m10=i,this.m11=h,this}mulMatrices(t,s){const i=t.m00,e=t.m01,h=t.m10,n=t.m11,m=s.m00,a=s.m01,r=s.m10,o=s.m11;return this.m00=i*m+e*r,this.m01=i*a+e*o,this.m10=h*m+n*r,this.m11=h*a+n*o,this}inverseMatrix(t){const s=t.m00,i=t.m01,e=t.m10,h=t.m11,n=s*h-e*i;if(0===n)throw new Error("Determinant of the matrix cannot be zero!");const m=1/n;return this.m00=h*m,this.m01=e*m,this.m10=i*m,this.m11=s*m,this}scaleMatrix(t,s,i){const e=t.m00,h=t.m01,n=t.m10,m=t.m11;return this.m00=s*e,this.m01=i*h,this.m10=s*n,this.m11=i*m,this}rotateMatrix(t,s){const i=t.m00,e=t.m01,h=t.m10,n=t.m11,m=Math.cos(s),a=Math.sin(s);return this.m00=m*i-a*e,this.m01=m*e+a*i,this.m10=m*h-a*n,this.m11=m*n+a*h,this}transpose(){return this.transposeMatrix(this)}inverse(){return this.inverseMatrix(this)}scale(t,s){return this.scaleMatrix(this,t,s)}rotate(t){return this.rotateMatrix(this,t)}}class r{static identity(){return new r(1,0,0,0,1,0,0,0,1)}static scale(t,s,i){return new r(t,0,0,0,s,0,0,0,i)}static translate(t,s){return new r(1,0,t,0,1,s,0,0,1)}static rotateX(t){const s=Math.cos(t),i=Math.sin(t);return new r(1,0,0,0,s,-i,0,i,s)}static rotateY(t){const s=Math.cos(t),i=Math.sin(t);return new r(s,0,i,0,1,0,-i,0,s)}static rotateZ(t){const s=Math.cos(t),i=Math.sin(t);return new r(s,-i,0,i,s,0,0,0,1)}static rotate(t,s,i,e){const h=Math.cos(e),n=Math.sin(e),m=1-h,a=Math.sqrt(t*t+s*s+i*i);if(0==a)throw new Error("axis vector length must be non zero!");const o=1/a,c=o*t,l=o*s,x=o*i,d=c*l,u=c*n,_=c*x,y=l*n,p=l*x,z=x*n;return new r(h+c*c*m,d*m-z,_*m+y,d*m+z,l*l*m+h,p*m-u,_*m-y,p*m+u,x*x*m+h)}constructor(t=1,s=0,i=0,e=0,h=1,n=0,m=0,a=0,r=1){this.m00=t,this.m01=e,this.m02=m,this.m10=s,this.m11=h,this.m12=a,this.m20=i,this.m21=n,this.m22=r}clone(){return new r(this.m00,this.m10,this.m20,this.m01,this.m11,this.m21,this.m02,this.m12,this.m22)}determinant(){return this.m00*(this.m11*this.m22-this.m12*this.m21)-this.m01*(this.m10*this.m22-this.m12*this.m20)+this.m02*(this.m10*this.m21-this.m11*this.m20)}isIdentity(){return 1===this.m00&&0===this.m01&&0===this.m02&&0===this.m10&&1===this.m11&&0===this.m12&&0===this.m20&&0===this.m21&&1===this.m22}equals(s){return Math.abs(this.m00-s.m00)<=t&&Math.abs(this.m10-s.m10)<=t&&Math.abs(this.m20-s.m20)<=t&&Math.abs(this.m01-s.m01)<=t&&Math.abs(this.m11-s.m11)<=t&&Math.abs(this.m21-s.m21)<=t&&Math.abs(this.m02-s.m02)<=t&&Math.abs(this.m12-s.m12)<=t&&Math.abs(this.m22-s.m22)<=t}identity(){return this.m00=1,this.m01=0,this.m02=0,this.m10=0,this.m11=1,this.m12=0,this.m20=0,this.m21=0,this.m22=1,this}set(t,s,i,e,h,n,m,a,r){return this.m00=t,this.m01=s,this.m02=i,this.m10=e,this.m11=h,this.m12=n,this.m20=m,this.m21=a,this.m22=r,this}copy(t){return this.m00=t.m00,this.m01=t.m01,this.m02=t.m02,this.m10=t.m10,this.m11=t.m11,this.m12=t.m12,this.m20=t.m20,this.m21=t.m21,this.m22=t.m22,this}transposeMatrix(t){const s=t.m00,i=t.m01,e=t.m02,h=t.m10,n=t.m11,m=t.m12,a=t.m20,r=t.m21,o=t.m22;return this.m00=s,this.m01=h,this.m02=a,this.m10=i,this.m11=n,this.m12=r,this.m20=e,this.m21=m,this.m22=o,this}mulMatrices(t,s){const i=t.m00,e=t.m01,h=t.m02,n=t.m10,m=t.m11,a=t.m12,r=t.m20,o=t.m21,c=t.m22,l=s.m00,x=s.m01,d=s.m02,u=s.m10,_=s.m11,y=s.m12,p=s.m20,z=s.m21,M=s.m22;return this.m00=i*l+e*u+h*p,this.m01=i*x+e*_+h*z,this.m02=i*d+e*y+h*M,this.m10=n*l+m*u+a*p,this.m11=n*x+m*_+a*z,this.m12=n*d+m*y+a*M,this.m20=r*l+o*u+c*p,this.m21=r*x+o*_+c*z,this.m22=r*d+o*y+c*M,this}inverseMatrix(t){const s=t.m00,i=t.m01,e=t.m02,h=t.m10,n=t.m11,m=t.m12,a=t.m20,r=t.m21,o=t.m22,c=n*o-m*r,l=e*r-i*o,x=i*m-e*n,d=m*a-h*o,u=s*o-e*a,_=e*h-s*m,y=h*r-n*a,p=i*a-s*r,z=s*n-i*h,M=s*c+h*l+a*x;if(0===M)throw new Error("Determinant of the matrix cannot be zero!");const f=1/M;return this.m00=c*f,this.m01=l*f,this.m02=x*f,this.m10=d*f,this.m11=u*f,this.m12=_*f,this.m20=y*f,this.m21=p*f,this.m22=z*f,this}scaleMatrix(t,s,i,e){const h=t.m00,n=t.m01,m=t.m02,a=t.m10,r=t.m11,o=t.m12,c=t.m20,l=t.m21,x=t.m22;return this.m00=s*h,this.m01=i*n,this.m02=e*m,this.m10=s*a,this.m11=i*r,this.m12=e*o,this.m20=s*c,this.m21=i*l,this.m22=e*x,this}translateMatrix(t,s,i,e){const h=t.m00,n=t.m01,m=t.m02,a=t.m10,r=t.m11,o=t.m12,c=t.m20,l=t.m21,x=t.m22;return this.m03=s*h+i*n+e*m,this.m13=s*a+i*r+e*o,this.m23=s*c+i*l+e*x,this}rotateMatrixX(t,s){const i=t.m01,e=t.m02,h=t.m11,n=t.m12,m=t.m21,a=t.m22,r=Math.cos(s),o=Math.sin(s);return this.m01=r*i-o*e,this.m02=r*e+o*i,this.m11=r*h-o*n,this.m12=r*n+o*h,this.m21=r*m-o*a,this.m22=r*a+o*m,this}rotateMatrixY(t,s){const i=t.m00,e=t.m02,h=t.m10,n=t.m12,m=t.m20,a=t.m22,r=Math.cos(s),o=Math.sin(s);return this.m00=r*i+o*e,this.m02=r*e-o*i,this.m10=r*h+o*n,this.m12=r*n-o*h,this.m20=r*m+o*a,this.m22=r*a-o*m,this}rotateMatrixZ(t,s){const i=t.m00,e=t.m01,h=t.m10,n=t.m11,m=t.m20,a=t.m21,r=Math.cos(s),o=Math.sin(s);return this.m00=r*i-o*e,this.m01=r*e+o*i,this.m10=r*h-o*n,this.m11=r*n+o*h,this.m20=r*m-o*a,this.m21=r*a+o*m,this}rotateMatrix(t,s,i,e,h){const n=t.m00,m=t.m01,a=t.m02,r=t.m10,o=t.m11,c=t.m12,l=t.m20,x=t.m21,d=t.m22,u=Math.cos(h),_=Math.sin(h),y=1-u,p=Math.sqrt(s*s+i*i+e*e);if(0==p)throw new Error("axis vector length must be non zero!");const z=1/p,M=z*s,f=z*i,w=z*e,g=M*f,b=M*_,S=M*w,D=f*_,F=f*w,k=w*_,v=u+M*M*y,E=g*y-k,q=S*y+D,V=g*y+k,X=f*f*y+u,Y=F*y-b,Z=S*y-D,O=F*y+b,B=w*w*y+u;return this.m00=r*E+l*q+n*v,this.m01=n*V+l*Y+r*X,this.m02=n*Z+r*O+l*B,this.m10=o*E+x*q+m*v,this.m11=m*V+x*Y+o*X,this.m12=m*Z+o*O+x*B,this.m20=c*E+d*q+a*v,this.m21=a*V+d*Y+c*X,this.m22=a*Z+c*O+d*B,this}transpose(){return this.transposeMatrix(this)}inverse(){return this.inverseMatrix(this)}scale(t,s,i){return this.scaleMatrix(this,t,s,i)}translate(t,s,i){return this.translateMatrix(this,t,s,i)}rotateX(t){return this.rotateMatrixX(this,t)}rotateY(t){return this.rotateMatrixY(this,t)}rotateZ(t){return this.rotateMatrixZ(this,t)}rotate(t,s,i,e){return this.rotateMatrix(this,t,s,i,e)}}class o{static identity(){return new o(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}static scale(t,s,i){return new o(t,0,0,0,0,s,0,0,0,0,i,0,0,0,0,1)}static translate(t,s,i){return new o(0,0,0,0,0,0,0,0,0,0,0,0,t,s,i,1)}static rotateX(t){const s=Math.cos(t),i=Math.sin(t);return new o(1,0,0,0,0,s,-i,0,0,i,s,0,0,0,0,1)}static rotateY(t){const s=Math.cos(t),i=Math.sin(t);return new o(s,0,i,0,0,1,0,0,-i,0,s,0,0,0,0,1)}static rotateZ(t){const s=Math.cos(t),i=Math.sin(t);return new o(s,-i,0,0,i,s,0,0,0,0,1,0,0,0,0,1)}static rotate(t,s,i,e){const h=Math.cos(e),n=Math.sin(e),m=1-h,a=Math.sqrt(t*t+s*s+i*i);if(0==a)throw new Error("axis vector length must be non zero!");const r=1/a,c=r*t,l=r*s,x=r*i,d=c*l,u=c*n,_=c*x,y=l*n,p=l*x,z=x*n;return new o(h+c*c*m,d*m-z,_*m+y,0,d*m+z,l*l*m+h,p*m-u,0,_*m-y,p*m+u,x*x*m+h,0,0,0,0,1)}constructor(t=1,s=0,i=0,e=0,h=0,n=1,m=0,a=0,r=0,o=0,c=1,l=0,x=0,d=0,u=0,_=1){this.m00=t,this.m01=h,this.m02=r,this.m03=x,this.m10=s,this.m11=n,this.m12=o,this.m13=d,this.m20=i,this.m21=m,this.m22=c,this.m23=u,this.m30=e,this.m31=a,this.m32=l,this.m33=_}clone(){return new o(this.m00,this.m10,this.m20,this.m30,this.m01,this.m11,this.m21,this.m31,this.m02,this.m12,this.m22,this.m32,this.m03,this.m13,this.m23,this.m33)}determinant(){const t=this.m22*this.m33-this.m23*this.m32,s=this.m21*this.m33-this.m23*this.m31,i=this.m21*this.m32-this.m22*this.m31,e=this.m20*this.m33-this.m23*this.m30,h=this.m20*this.m32-this.m22*this.m30,n=this.m20*this.m31-this.m21*this.m30,m=this.m11*t-this.m12*s+this.m13*i,a=this.m10*t-this.m12*e+this.m13*h,r=this.m10*s-this.m11*e+this.m13*n,o=this.m10*i-this.m11*h+this.m12*n;return this.m00*m-this.m01*a+this.m02*r-this.m03*o}isIdentity(){return 1===this.m00&&0===this.m01&&0===this.m02&&0===this.m03&&0===this.m10&&1===this.m11&&0===this.m12&&0===this.m13&&0===this.m20&&0===this.m21&&1===this.m22&&0===this.m23&&0===this.m30&&0===this.m31&&0===this.m32&&1===this.m33}equals(s){return Math.abs(this.m00-s.m00)<=t&&Math.abs(this.m10-s.m10)<=t&&Math.abs(this.m20-s.m20)<=t&&Math.abs(this.m30-s.m30)<=t&&Math.abs(this.m01-s.m01)<=t&&Math.abs(this.m11-s.m11)<=t&&Math.abs(this.m21-s.m21)<=t&&Math.abs(this.m31-s.m31)<=t&&Math.abs(this.m02-s.m02)<=t&&Math.abs(this.m12-s.m12)<=t&&Math.abs(this.m22-s.m22)<=t&&Math.abs(this.m32-s.m32)<=t&&Math.abs(this.m03-s.m03)<=t&&Math.abs(this.m13-s.m13)<=t&&Math.abs(this.m23-s.m23)<=t&&Math.abs(this.m33-s.m33)<=t}identity(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m10=0,this.m11=1,this.m12=0,this.m13=0,this.m20=0,this.m21=0,this.m22=1,this.m23=0,this.m30=0,this.m31=0,this.m32=0,this.m33=1,this}set(t,s,i,e,h,n,m,a,r,o,c,l,x,d,u,_){return this.m00=t,this.m01=s,this.m02=i,this.m03=e,this.m10=h,this.m11=n,this.m12=m,this.m13=a,this.m20=r,this.m21=o,this.m22=c,this.m23=l,this.m30=x,this.m31=d,this.m32=u,this.m33=_,this}setCols(t,s,i,e,h,n,m,a,r,o,c,l,x,d,u,_){return this.m00=t,this.m01=s,this.m02=i,this.m03=e,this.m10=h,this.m11=n,this.m12=m,this.m13=a,this.m20=r,this.m21=o,this.m22=c,this.m23=l,this.m30=x,this.m31=d,this.m32=u,this.m33=_,this}setRows(t,s,i,e,h,n,m,a,r,o,c,l,x,d,u,_){return this.m00=t,this.m01=h,this.m02=r,this.m03=x,this.m10=s,this.m11=n,this.m12=o,this.m13=d,this.m20=i,this.m21=m,this.m22=c,this.m23=u,this.m30=e,this.m31=a,this.m32=l,this.m33=_,this}copy(t){return this.m00=t.m00,this.m01=t.m01,this.m02=t.m02,this.m03=t.m03,this.m10=t.m10,this.m11=t.m11,this.m12=t.m12,this.m13=t.m13,this.m20=t.m20,this.m21=t.m21,this.m22=t.m22,this.m23=t.m23,this.m30=t.m30,this.m31=t.m31,this.m32=t.m32,this.m33=t.m33,this}transposeMatrix(t){const s=t.m00,i=t.m01,e=t.m02,h=t.m03,n=t.m10,m=t.m11,a=t.m12,r=t.m13,o=t.m20,c=t.m21,l=t.m22,x=t.m23,d=t.m30,u=t.m31,_=t.m32,y=t.m33;return this.m00=s,this.m01=n,this.m02=o,this.m03=d,this.m10=i,this.m11=m,this.m12=c,this.m13=u,this.m20=e,this.m21=a,this.m22=l,this.m23=_,this.m30=h,this.m31=r,this.m32=x,this.m33=y,this}mulMatrices(t,s){const i=t.m00,e=t.m01,h=t.m02,n=t.m03,m=t.m10,a=t.m11,r=t.m12,o=t.m13,c=t.m20,l=t.m21,x=t.m22,d=t.m23,u=t.m30,_=t.m31,y=t.m32,p=t.m33,z=s.m00,M=s.m01,f=s.m02,w=s.m03,g=s.m10,b=s.m11,S=s.m12,D=s.m13,F=s.m20,k=s.m21,v=s.m22,E=s.m23,q=s.m30,V=s.m31,X=s.m32,Y=s.m33;return this.m00=i*z+m*M+c*f+u*w,this.m01=i*g+m*b+c*S+u*D,this.m02=i*F+m*k+c*v+u*E,this.m03=i*q+m*V+c*X+u*Y,this.m10=e*z+a*M+l*f+_*w,this.m11=e*g+a*b+l*S+_*D,this.m12=e*F+a*k+l*v+_*E,this.m13=e*q+a*V+l*X+_*Y,this.m20=h*z+r*M+x*f+y*w,this.m21=h*g+r*b+x*S+y*D,this.m22=h*F+r*k+x*v+y*E,this.m23=h*q+r*V+x*X+y*Y,this.m30=n*z+o*M+d*f+p*w,this.m31=n*g+o*b+d*S+p*D,this.m32=n*F+o*k+d*v+p*E,this.m33=n*q+o*V+d*X+p*Y,this}inverseMatrix(t){const s=t.m00,i=t.m01,e=t.m02,h=t.m03,n=t.m10,m=t.m11,a=t.m12,r=t.m13,o=t.m20,c=t.m21,l=t.m22,x=t.m23,d=t.m30,u=t.m31,_=t.m32,y=t.m33,p=l*y-x*_,z=a*y-x*u,M=a*_-l*u,f=e*y-x*d,w=e*_-l*d,g=e*u-c*d,b=o*r-h*a,S=n*r-h*m,D=n*a-e*m,F=s*r-h*n,k=s*a-e*n,v=s*m-i*n,E=m*p-a*z+r*M,q=c*f-r*w-n*p,V=i*z-m*f+r*g,X=m*w-a*g-n*M,Y=o*z-h*M-i*p,Z=s*p-e*f+h*w,O=n*f-h*g-s*z,B=s*M-i*w+e*g,I=r*b-_*S+y*D,T=x*F-y*k-d*b,P=h*S-u*F+y*v,C=r*k-_*v-d*D,U=l*S-x*D-c*b,A=e*b-l*F+x*k,L=a*F-x*v-o*S,j=e*D-c*k+l*v,N=s*E+i*q+e*V+h*X;if(0===N)throw new Error("Determinant of the cofactor matrix cannot be zero!");const $=1/N;return this.m00=E*$,this.m01=Y*$,this.m02=I*$,this.m03=U*$,this.m10=q*$,this.m11=Z*$,this.m12=T*$,this.m13=A*$,this.m20=V*$,this.m21=O*$,this.m22=P*$,this.m23=L*$,this.m30=X*$,this.m31=B*$,this.m32=C*$,this.m33=j*$,this}scaleMatrix(t,s,i,e){const h=t.m00,n=t.m01,m=t.m02,a=t.m10,r=t.m11,o=t.m12,c=t.m20,l=t.m21,x=t.m22,d=t.m30,u=t.m31,_=t.m32;return this.m00=s*h,this.m01=i*n,this.m02=e*m,this.m10=s*a,this.m11=i*r,this.m12=e*o,this.m20=s*c,this.m21=i*l,this.m22=e*x,this.m30=s*d,this.m31=i*u,this.m32=e*_,this}translateMatrix(t,s,i,e){const h=t.m00,n=t.m01,m=t.m02,a=t.m03,r=t.m10,o=t.m11,c=t.m12,l=t.m13,x=t.m20,d=t.m21,u=t.m22,_=t.m23,y=t.m30,p=t.m31,z=t.m32,M=t.m33;return this.m00=h+s*a,this.m10=r+s*l,this.m20=x+s*_,this.m30=y+s*M,this.m01=n+i*a,this.m11=o+i*l,this.m21=d+i*_,this.m31=p+i*M,this.m02=m+e*a,this.m12=c+e*l,this.m22=u+e*_,this.m32=z+e*M,this.m03=a,this.m13=l,this.m23=_,this.m33=M,this}rotateMatrixX(t,s){const i=t.m01,e=t.m02,h=t.m11,n=t.m12,m=t.m21,a=t.m22,r=t.m31,o=t.m32,c=Math.cos(s),l=Math.sin(s);return this.m01=c*i-l*e,this.m02=c*e+l*i,this.m11=c*h-l*n,this.m12=c*n+l*h,this.m21=c*m-l*a,this.m22=c*a+l*m,this.m31=c*r-l*o,this.m32=c*o+l*r,this}rotateMatrixY(t,s){const i=t.m00,e=t.m02,h=t.m10,n=t.m12,m=t.m20,a=t.m22,r=t.m30,o=t.m32,c=Math.cos(s),l=Math.sin(s);return this.m00=c*i+l*e,this.m02=c*e-l*i,this.m10=c*h+l*n,this.m12=c*n-l*h,this.m20=c*m+l*a,this.m22=c*a-l*m,this.m30=c*r+l*o,this.m32=c*o-l*r,this}rotateMatrixZ(t,s){const i=t.m00,e=t.m01,h=t.m10,n=t.m11,m=t.m20,a=t.m21,r=t.m30,o=t.m31,c=Math.cos(s),l=Math.sin(s);return this.m00=c*i-l*e,this.m01=c*e+l*i,this.m10=c*h-l*n,this.m11=c*n+l*h,this.m20=c*m-l*a,this.m21=c*a+l*m,this.m30=c*r-l*o,this.m31=c*o+l*r,this}rotateMatrix(t,s,i,e,h){const n=t.m00,m=t.m01,a=t.m02,r=t.m03,o=t.m10,c=t.m11,l=t.m12,x=t.m13,d=t.m20,u=t.m21,_=t.m22,y=t.m23,p=Math.cos(h),z=Math.sin(h),M=1-p,f=Math.sqrt(s*s+i*i+e*e);if(0==f)throw new Error("axis vector length must be non zero!");const w=1/f,g=w*s,b=w*i,S=w*e,D=g*b,F=g*z,k=g*S,v=b*z,E=b*S,q=S*z,V=p+g*g*M,X=D*M-q,Y=k*M+v,Z=D*M+q,O=b*b*M+p,B=E*M-F,I=k*M-v,T=E*M+F,P=S*S*M+p;return this.m00=o*X+d*Y+n*V,this.m01=n*Z+d*B+o*O,this.m02=n*I+o*T+d*P,this.m10=c*X+u*Y+m*V,this.m11=m*Z+u*B+c*O,this.m12=m*I+c*T+u*P,this.m20=l*X+_*Y+a*V,this.m21=a*Z+_*B+l*O,this.m22=a*I+l*T+_*P,this.m30=x*X+y*Y+r*V,this.m31=r*Z+y*B+x*O,this.m32=r*I+x*T+y*P,this}transpose(){return this.transposeMatrix(this)}inverse(){return this.inverseMatrix(this)}scale(t,s,i){return this.scaleMatrix(this,t,s,i)}translate(t,s,i){return this.translateMatrix(this,t,s,i)}rotateX(t){return this.rotateMatrixX(this,t)}rotateY(t){return this.rotateMatrixY(this,t)}rotateZ(t){return this.rotateMatrixZ(this,t)}rotate(t,s,i,e){return this.rotateMatrix(this,t,s,i,e)}}function c(t,s,i){return t>i?i:t<s?s:t}function l(t,s){return t<s?l(s,t):Math.abs(s)<.001?t:l(s,t-Math.floor(t/s)*s)}function x(t,s,i,e){if(t==s&&t==i){const s=t/e;return Math.floor(s)/s*e}const h=l(t,l(s,i));return e<h?Math.min(Math.floor(h/e),1)*e:Math.max(Math.floor(e/h),1)*h}function d(t,s,i){return Math.sqrt(t*t+s*s+i*i)}class u{constructor(t=new i(0,0,0),h=new i(0,0,0),n=new e(0,0,0,1),m=new s(0,0),a=0){this.position=t,this.normal=h,this.colour=n,this.texture_coords=m,this.texture_id=a}}class _{constructor(t=[],s=[]){this.vertices=t,this.indices=s}}function y(t,s,i,e){let h=t.subdivision_count<s.subdivision_count?t:s;return h=h.subdivision_count<i.subdivision_count?h:i,h=h.subdivision_count<e.subdivision_count?h:e,h}function p(t,s,i,e,h,n,m,a,r,o){const c=(a-s)/(h-s),l=1-c,x=(r-i)/(n-i),d=1-x,u=(o-e)/(m-e),_=1-u,y=t.calculateSignedDistance(s,i,e),p=t.calculateSignedDistance(h,i,e),z=t.calculateSignedDistance(h,n,e),M=t.calculateSignedDistance(s,n,e),f=t.calculateSignedDistance(s,i,m),w=t.calculateSignedDistance(h,i,m),g=t.calculateSignedDistance(h,n,m);return((y*l+p*c)*d+(M*l+z*c)*x)*_+((f*l+w*c)*d+(t.calculateSignedDistance(s,n,m)*l+g*c)*x)*u}class z{constructor(t,s,i,e,h,n,m,a){this.x0=t,this.y0=s,this.z0=i,this.x1=h,this.y1=n,this.z1=m,this.sample0=e,this.sample1=a}set(t,s,i,e,h,n,m,a){this.x0=t,this.y0=s,this.z0=i,this.x1=h,this.y1=n,this.z1=m,this.sample0=e,this.sample1=a}}class M{constructor(t,s,i,e,h,n,m=1){this.kind=4,this.min_x=t,this.min_y=s,this.min_z=i,this.max_x=e,this.max_y=h,this.max_z=n,this.subdivision_count=m,this.node000=null,this.node100=null,this.node110=null,this.node010=null,this.node001=null,this.node101=null,this.node111=null,this.node011=null,this.sample000=null,this.sample100=null,this.sample110=null,this.sample010=null,this.sample001=null,this.sample101=null,this.sample111=null,this.sample011=null}sampleSignedDistanceField(t,s=null){const i=this.min_x,e=this.max_x,h=(e+i)/2,n=this.min_y,m=this.max_y,a=(m+n)/2,r=this.min_z,o=this.max_z,c=(o+r)/2,l=t.calculateSignedDistance(h,a,c),x=t.calculateSignedDistance(e,a,c),d=t.calculateSignedDistance(i,a,c),u=t.calculateSignedDistance(h,n,c),_=t.calculateSignedDistance(h,m,c),y=t.calculateSignedDistance(h,a,o),z=t.calculateSignedDistance(h,a,r);if(null!=s){const M=p(t,i,n,r,e,m,o,h,a,c),w=p(t,i,n,r,e,m,o,e,a,c),g=p(t,i,n,r,e,m,o,i,a,c),b=p(t,i,n,r,e,m,o,h,n,c),S=p(t,i,n,r,e,m,o,h,m,c),D=p(t,i,n,r,e,m,o,h,a,o),F=p(t,i,n,r,e,m,o,h,a,r);if(Math.abs(l-M)<=s&&Math.abs(x-w)<=s&&Math.abs(d-g)<=s&&Math.abs(u-b)<=s&&Math.abs(_-S)<=s&&Math.abs(y-D)<=s&&Math.abs(z-F)<=s){const s=new f(i,n,r,e,m,o);return s.sample000=t.calculateSignedDistance(i,n,r),s.sample001=t.calculateSignedDistance(i,n,o),s.sample010=t.calculateSignedDistance(i,m,r),s.sample011=t.calculateSignedDistance(i,m,o),s.sample100=t.calculateSignedDistance(e,n,r),s.sample101=t.calculateSignedDistance(e,n,o),s.sample110=t.calculateSignedDistance(e,m,r),s.sample111=t.calculateSignedDistance(e,m,o),s.sampleSignedDistanceField(t)}}if(1==this.subdivision_count)this.node000=new f(i,n,r,h,a,c,0),this.node001=new f(i,n,c,h,a,o,0),this.node010=new f(i,a,r,h,m,c,0),this.node011=new f(i,a,c,h,m,o,0),this.node100=new f(h,n,r,e,a,c,0),this.node101=new f(h,n,c,e,a,o,0),this.node110=new f(h,a,r,e,m,c,0),this.node111=new f(h,a,c,e,m,o,0);else{const t=this.subdivision_count-1;this.node000=new M(i,n,r,h,a,c,t),this.node001=new M(i,n,c,h,a,o,t),this.node010=new M(i,a,r,h,m,c,t),this.node011=new M(i,a,c,h,m,o,t),this.node100=new M(h,n,r,e,a,c,t),this.node101=new M(h,n,c,e,a,o,t),this.node110=new M(h,a,r,e,m,c,t),this.node111=new M(h,a,c,e,m,o,t)}const w=t.calculateSignedDistance(h,n,r),g=t.calculateSignedDistance(h,m,r),b=t.calculateSignedDistance(h,m,o),S=t.calculateSignedDistance(h,n,o),D=t.calculateSignedDistance(i,a,r),F=t.calculateSignedDistance(e,a,r),k=t.calculateSignedDistance(e,a,o),v=t.calculateSignedDistance(i,a,o),E=t.calculateSignedDistance(i,n,c),q=t.calculateSignedDistance(e,n,c),V=t.calculateSignedDistance(e,m,c),X=t.calculateSignedDistance(i,m,c);this.sample000??=t.calculateSignedDistance(i,n,r),this.sample001??=t.calculateSignedDistance(i,n,o),this.sample010??=t.calculateSignedDistance(i,m,r),this.sample011??=t.calculateSignedDistance(i,m,o),this.sample100??=t.calculateSignedDistance(e,n,r),this.sample101??=t.calculateSignedDistance(e,n,o),this.sample110??=t.calculateSignedDistance(e,m,r),this.sample111??=t.calculateSignedDistance(e,m,o),this.node000.sample000=this.sample000,this.node001.sample001=this.sample001,this.node010.sample010=this.sample010,this.node011.sample011=this.sample011,this.node100.sample100=this.sample100,this.node101.sample101=this.sample101,this.node110.sample110=this.sample110,this.node111.sample111=this.sample111,this.node000.sample111=l,this.node001.sample110=l,this.node010.sample101=l,this.node011.sample100=l,this.node100.sample011=l,this.node101.sample010=l,this.node110.sample001=l,this.node111.sample000=l,this.node100.sample111=x,this.node101.sample110=x,this.node110.sample101=x,this.node111.sample100=x,this.node000.sample011=d,this.node001.sample010=d,this.node010.sample001=d,this.node011.sample000=d,this.node010.sample111=_,this.node011.sample110=_,this.node110.sample011=_,this.node111.sample010=_,this.node000.sample101=u,this.node001.sample100=u,this.node100.sample001=u,this.node101.sample000=u,this.node001.sample111=y,this.node011.sample101=y,this.node101.sample011=y,this.node111.sample001=y,this.node000.sample110=z,this.node010.sample100=z,this.node100.sample010=z,this.node110.sample000=z,this.node100.sample000=this.node000.sample100=w,this.node110.sample010=this.node010.sample110=g,this.node111.sample011=this.node011.sample111=b,this.node101.sample001=this.node001.sample101=S,this.node010.sample000=this.node000.sample010=D,this.node110.sample100=this.node100.sample110=F,this.node111.sample101=this.node101.sample111=k,this.node011.sample001=this.node001.sample011=v,this.node001.sample000=this.node000.sample001=E,this.node101.sample100=this.node100.sample101=q,this.node111.sample110=this.node110.sample111=V,this.node011.sample010=this.node010.sample011=X,this.sample000=null,this.sample001=null,this.sample010=null,this.sample011=null,this.sample100=null,this.sample101=null,this.sample110=null,this.sample111=null,this.node000=this.node000.sampleSignedDistanceField(t,s),this.node001=this.node001.sampleSignedDistanceField(t,s),this.node010=this.node010.sampleSignedDistanceField(t,s),this.node011=this.node011.sampleSignedDistanceField(t,s),this.node100=this.node100.sampleSignedDistanceField(t,s),this.node101=this.node101.sampleSignedDistanceField(t,s),this.node110=this.node110.sampleSignedDistanceField(t,s),this.node111=this.node111.sampleSignedDistanceField(t,s);const Y=this.node000.kind|this.node100.kind|this.node110.kind|this.node010.kind|this.node001.kind|this.node101.kind|this.node111.kind|this.node011.kind;return 1==Y?A:2==Y?L:this}}class f{constructor(t,s,i,e,h,n){this.kind=8,this.min_x=t,this.min_y=s,this.min_z=i,this.max_x=e,this.max_y=h,this.max_z=n,this.sample000=0,this.sample100=0,this.sample110=0,this.sample010=0,this.sample001=0,this.sample101=0,this.sample111=0,this.sample011=0,this.surface_vertex=null}getNodeState(){let t=0;return this.sample000<0&&(t|=1),this.sample001<0&&(t|=2),this.sample010<0&&(t|=4),this.sample011<0&&(t|=8),this.sample100<0&&(t|=16),this.sample101<0&&(t|=32),this.sample110<0&&(t|=64),this.sample111<0&&(t|=128),t}sampleSignedDistanceField(t){this.min_x,this.max_x,this.min_y,this.max_y,this.min_z,this.max_z;const s=this.getNodeState();if(255==s)return A;if(0==s)return L;const i=this.calculateSurfacePosition(),e=t.calculateGradient(i.x,i.y,i.z).normalize();return this.surface_vertex=new u(i,e),this}calculateSurfacePosition(){const t=this.getTemporaryEdges();let s=0,e=0,h=0,n=0;for(let i=0;i<t.length;++i){const m=t[i];if(m.sample0<0!=m.sample1<0){const t=Math.abs(m.sample0)/(Math.abs(m.sample0)+Math.abs(m.sample1));s+=(m.x1-m.x0)*t+m.x0,e+=(m.y1-m.y0)*t+m.y0,h+=(m.z1-m.z0)*t+m.z0,n+=1}}if(0==n)return null;const m=1/n;return new i(s*m,e*m,h*m)}getTemporaryEdges(){const t=this.min_x,s=this.min_y,i=this.min_z,e=this.max_x,h=this.max_y,n=this.max_z;return G[0].set(t,s,i,this.sample000,e,s,i,this.sample100),G[1].set(t,h,i,this.sample010,e,h,i,this.sample110),G[2].set(t,s,n,this.sample001,e,s,n,this.sample101),G[3].set(t,h,n,this.sample011,e,h,n,this.sample111),G[4].set(t,s,i,this.sample000,t,h,i,this.sample010),G[5].set(e,s,i,this.sample100,e,h,i,this.sample110),G[6].set(t,s,n,this.sample001,t,h,n,this.sample011),G[7].set(e,s,n,this.sample101,e,h,n,this.sample111),G[8].set(t,s,i,this.sample000,t,s,n,this.sample001),G[9].set(e,s,i,this.sample100,e,s,n,this.sample101),G[10].set(e,h,i,this.sample110,e,h,n,this.sample111),G[11].set(t,h,i,this.sample010,t,h,n,this.sample011),G}}class w{constructor(){this.kind=2}}class g{constructor(){this.kind=1}}class b{constructor(){this.vertices=[],this.indices=[]}getMesh(){return new _(this.vertices,this.indices)}clear(){this.vertices=[],this.indices=[]}buildMesh(...t){for(let s=0;s<t.length;++s)this.processCell(t[s]);return new _(this.vertices,this.indices)}addTriangle(t,s,i,e=!1){const h=this.vertices.length;e?this.indices.push(h+2,h+1,h+0):this.indices.push(h+0,h+1,h+2),this.vertices.push(t.surface_vertex,s.surface_vertex,i.surface_vertex)}addQuad(t,s,i,e,h=!1){if(t==s)return this.addTriangle(t,i,e,h);if(t==i)throw new Error("Invalid quad winding!");if(t==e)return this.addTriangle(t,s,i,h);if(s==i)return this.addTriangle(t,s,e,h);if(s==e)throw new Error("Invalid quad winding!");if(i==e)return this.addTriangle(t,s,i,h);const n=this.vertices.length;h?this.indices.push(n+3,n+2,n+0,n+2,n+1,n+0):this.indices.push(n+0,n+1,n+2,n+0,n+2,n+3),this.vertices.push(t.surface_vertex,s.surface_vertex,i.surface_vertex,e.surface_vertex)}processCell(t){4==t.kind&&(this.processCell(t.node000),this.processCell(t.node001),this.processCell(t.node010),this.processCell(t.node011),this.processCell(t.node100),this.processCell(t.node101),this.processCell(t.node110),this.processCell(t.node111),this.processFaceX(t.node000,t.node100),this.processFaceX(t.node010,t.node110),this.processFaceX(t.node011,t.node111),this.processFaceX(t.node001,t.node101),this.processFaceY(t.node000,t.node010),this.processFaceY(t.node100,t.node110),this.processFaceY(t.node101,t.node111),this.processFaceY(t.node001,t.node011),this.processFaceZ(t.node000,t.node001),this.processFaceZ(t.node100,t.node101),this.processFaceZ(t.node110,t.node111),this.processFaceZ(t.node010,t.node011),this.processEdgeX(t.node000,t.node010,t.node011,t.node001),this.processEdgeX(t.node100,t.node110,t.node111,t.node101),this.processEdgeY(t.node000,t.node100,t.node101,t.node001),this.processEdgeY(t.node010,t.node110,t.node111,t.node011),this.processEdgeZ(t.node000,t.node100,t.node110,t.node010),this.processEdgeZ(t.node001,t.node101,t.node111,t.node011))}processFaceX(t,s){const i=t.kind|s.kind;if(3&i||!(4&i))return;let e=t,h=t,n=s,m=s,a=t,r=t,o=s,c=s;4==t.kind&&(e=t.node100,h=t.node110,a=t.node101,r=t.node111),4==s.kind&&(n=s.node000,m=s.node010,o=s.node001,c=s.node011),this.processFaceX(e,n),this.processFaceX(h,m),this.processFaceX(r,c),this.processFaceX(a,o),this.processEdgeY(e,n,o,a),this.processEdgeY(h,m,c,r),this.processEdgeZ(e,n,m,h),this.processEdgeZ(a,o,c,r)}processFaceY(t,s){const i=t.kind|s.kind;if(3&i||!(4&i))return;let e=t,h=t,n=s,m=s,a=t,r=t,o=s,c=s;4==t.kind&&(e=t.node010,h=t.node110,a=t.node011,r=t.node111),4==s.kind&&(n=s.node000,m=s.node100,o=s.node001,c=s.node101),this.processFaceY(e,n),this.processFaceY(h,m),this.processFaceY(r,c),this.processFaceY(a,o),this.processEdgeX(e,n,o,a),this.processEdgeX(h,m,c,r),this.processEdgeZ(e,h,m,n),this.processEdgeZ(a,r,c,o)}processFaceZ(t,s){const i=t.kind|s.kind;if(3&i||!(4&i))return;let e=t,h=t,n=s,m=s,a=t,r=t,o=s,c=s;4==t.kind&&(e=t.node001,h=t.node101,a=t.node011,r=t.node111),4==s.kind&&(n=s.node000,m=s.node100,o=s.node010,c=s.node110),this.processFaceZ(e,n),this.processFaceZ(h,m),this.processFaceZ(r,c),this.processFaceZ(a,o),this.processEdgeX(e,a,o,n),this.processEdgeX(h,r,c,m),this.processEdgeY(e,h,m,n),this.processEdgeY(a,r,c,o)}processEdgeX(t,s,i,e){const h=t.kind|s.kind|i.kind|e.kind;if(!(3&h))if(4&h){const h=4==t.kind?t.node011:t,n=4==t.kind?t.node111:t,m=4==s.kind?s.node001:s,a=4==s.kind?s.node101:s,r=4==e.kind?e.node010:e,o=4==e.kind?e.node110:e,c=4==i.kind?i.node000:i,l=4==i.kind?i.node100:i;this.processEdgeX(h,m,c,r),this.processEdgeX(n,a,l,o)}else{let h=!1;switch(y(t,s,i,e)){case t:h=t.sample111<t.sample011;break;case s:h=s.sample101<s.sample001;break;case i:h=i.sample100<i.sample000;break;case e:h=e.sample110<e.sample010}this.addQuad(t,s,i,e,h)}}processEdgeY(t,s,i,e){const h=t.kind|s.kind|i.kind|e.kind;if(!(3&h))if(4&h){const h=4==t.kind?t.node101:t,n=4==t.kind?t.node111:t,m=4==s.kind?s.node001:s,a=4==s.kind?s.node011:s,r=4==e.kind?e.node100:e,o=4==e.kind?e.node110:e,c=4==i.kind?i.node000:i,l=4==i.kind?i.node010:i;this.processEdgeY(h,m,c,r),this.processEdgeY(n,a,l,o)}else{let h=!1;switch(y(t,s,i,e)){case t:h=t.sample101<t.sample111;break;case s:h=s.sample001<s.sample011;break;case i:h=i.sample000<i.sample010;break;case e:h=e.sample100<e.sample110}this.addQuad(t,s,i,e,h)}}processEdgeZ(t,s,i,e){const h=t.kind|s.kind|i.kind|e.kind;if(!(3&h))if(4&h){const h=4==t.kind?t.node110:t,n=4==t.kind?t.node111:t,m=4==s.kind?s.node010:s,a=4==s.kind?s.node011:s,r=4==e.kind?e.node100:e,o=4==e.kind?e.node101:e,c=4==i.kind?i.node000:i,l=4==i.kind?i.node001:i;this.processEdgeZ(h,m,c,r),this.processEdgeZ(n,a,l,o)}else{let h=!1;switch(y(t,s,i,e)){case t:h=t.sample111<t.sample110;break;case s:h=s.sample011<s.sample010;break;case i:h=i.sample001<i.sample000;break;case e:h=e.sample101<e.sample100}this.addQuad(t,s,i,e,h)}}}class S{constructor(t){this.view=new DataView(t),this.offset=0}setOffset(t){this.offset=t}writeInt8(t){this.view.setInt8(this.offset,t),this.offset+=1}writeUint8(t){this.view.setUint8(this.offset,t),this.offset+=1}writeInt16(t,s){this.view.setInt16(this.offset,t,s),this.offset+=2}writeUint16(t,s){this.view.setUint16(this.offset,t,s),this.offset+=2}writeInt32(t,s){this.view.setInt32(this.offset,t,s),this.offset+=4}writeUint32(t,s){this.view.setUint32(this.offset,t,s),this.offset+=4}writeFloat32(t,s){this.view.setFloat32(this.offset,t,s),this.offset+=4}writeFloat64(t,s){this.view.setFloat64(this.offset,t,s),this.offset+=8}writeBuffer(t){new Uint8Array(this.view.buffer).set(new Uint8Array(t),this.offset),this.offset+=t.byteLength}}class D{calculateSignedDistance(t,s,i){throw new Error("calculateSignedDistance is unimplemented!")}calculateGradient(t,s,e,h=new i){const n=1e-5,m=this.calculateSignedDistance(t+n,s-n,e-n),a=this.calculateSignedDistance(t-n,s-n,e+n),r=this.calculateSignedDistance(t-n,s+n,e-n),o=this.calculateSignedDistance(t+n,s+n,e+n);return h.set(+m-a-r+o,-m-a+r+o,-m+a-r+o).normalize()}raycast(s,i,e,h,n,m,a=1/0){let r=0;for(let o=0;o<256&&r<a;++o){const a=this.calculateSignedDistance(s+r*h,i+r*n,e+r*m);if(a<t)return r;r+=a}return null}raycastIntersection(t,s,e,h,n,m,a=new i){const r=this.calculateSignedDistance(t,s,e);if(r<0==this.calculateSignedDistance(h,n,m)<0)return null;r<0&&([t,s,e,h,n,m]=[h,n,m,t,s,e]);const o=h-t,c=n-s,l=m-e,x=Math.sqrt(o*o+c*c+l*l);if(0==x)return null;const d=1/x,u=o*d,_=c*d,y=l*d,p=this.raycast(t,s,e,u,_,y,x);return null!=p?a.set(t+p*u,s+p*_,e+p*y):null}_raycastIntersection(t,s,e,h,n,m,a=new i){const r=h-t,o=n-s,c=m-e,l=1/Math.sqrt(r*r+o*o+c*c),x=r*l,d=o*l,u=c*l;for(let i=0;i<256;++i){const i=this.calculateSignedDistance(t,s,e),h=Math.abs(i);t+=x*h,s+=d*h,e+=u*h}return null}transform(t=new o){return new X(this,t)}rotateX(t=0){return this.transform(N.identity().rotateX(t))}rotateY(t=0){return this.transform(N.identity().rotateY(t))}rotateZ(t=0){return this.transform(N.identity().rotateZ(t))}twist(t=0){return new Y(this,t)}shell(t=1){return new Z(this,t)}offset(t=1){return new O(this,t)}union(...t){return new B([this,...t])}difference(...t){return new I([this,...t])}intersection(...t){return new T([this,...t])}unionSmooth(t=0,...s){return new P(t,[this,...s])}differenceSmooth(t=0,...s){return new C(t,[this,...s])}intersectionSmooth(t=0,...s){return new U(t,[this,...s])}translate(t=0,s=0,i=0){return this.transform(N.identity().translate(t,s,i))}rotate(t=0,s=0,i=1,e=0){return this.transform(N.identity().rotate(t,s,i,e))}}class F extends D{constructor(t,s,i,e=0){super(),this.corner_radius=e,this.half_size_x=.5*t,this.half_size_y=.5*s,this.half_size_z=.5*i,this.bounding_box=new n(-this.half_size_x,-this.half_size_y,-this.half_size_z,this.half_size_x,this.half_size_y,this.half_size_z)}calculateSignedDistance(t,s,i){const e=Math.abs(t)-this.half_size_x+this.corner_radius,h=Math.abs(s)-this.half_size_y+this.corner_radius,n=Math.abs(i)-this.half_size_z+this.corner_radius,m=Math.max(e,0),a=Math.max(h,0),r=Math.max(n,0),o=Math.min(Math.max(e,h,n),0);return Math.sqrt(m*m+a*a+r*r)+o-this.corner_radius}}class k extends D{constructor(t,s,i,e=5){super(),this.frame_size=e,this.half_size_x=.5*t,this.half_size_y=.5*s,this.half_size_z=.5*i,this.bounding_box=new n(-this.half_size_x,-this.half_size_y,-this.half_size_z,this.half_size_x,this.half_size_y,this.half_size_z)}calculateSignedDistance(t,s,i){const e=Math.abs(t)-this.half_size_x,h=Math.abs(s)-this.half_size_y,n=Math.abs(i)-this.half_size_z,m=Math.abs(e+this.frame_size)-this.frame_size,a=Math.abs(h+this.frame_size)-this.frame_size,r=Math.abs(n+this.frame_size)-this.frame_size;return Math.min(d(Math.max(m,0),Math.max(a,0),Math.max(n,0))+Math.min(Math.max(m,a,n),0),d(Math.max(e,0),Math.max(a,0),Math.max(r,0))+Math.min(Math.max(e,a,r),0),d(Math.max(m,0),Math.max(h,0),Math.max(r,0))+Math.min(Math.max(m,h,r),0))}}class v extends D{constructor(t=5){super(),this.radius=t,this.bounding_box=new n(-t,-t,-t,t,t,t)}calculateSignedDistance(t,s,i){return Math.sqrt(t*t+s*s+i*i)-this.radius}}class E extends D{constructor(t=10,s=5){super();const i=t+s;this.inner_radius=s,this.outer_radius=t,this.bounding_box=new n(-i,-i,-s,i,i,s)}calculateSignedDistance(t,s,i){const e=Math.sqrt(t*t+s*s)-this.outer_radius;return Math.sqrt(e*e+i*i)-this.inner_radius}}class q extends D{constructor(t=10,s=20){super(),this.radius=t,this.half_height=.5*s,this.bounding_box=new n(-this.radius,-this.radius,-this.half_height,this.radius,this.radius,this.half_height)}calculateSignedDistance(t,s,i){const e=Math.abs(Math.sqrt(t*t+s*s))-this.radius,h=Math.abs(i)-this.half_height,n=Math.max(e,0),m=Math.max(h,0);return Math.min(Math.max(e,h),0)+Math.sqrt(n*n+m*m)}}class V extends D{constructor(t=new m(0,0,1,0)){super(),this.plane=t,this.bounding_box=new n(1/0,1/0,1/0,-1/0,-1/0,-1/0)}calculateSignedDistance(t,s,i){return this.plane.distanceToPoint(t,s,i)}}class X extends D{constructor(t,s=new o){super(),this.matrix=s.clone(),this.inverse_matrix=this.matrix.clone().inverse(),this.bounding_box=t.bounding_box.clone().transformMatrix4(this.matrix),this.field=t}calculateSignedDistance(t,s,i){return $.set(t,s,i).transformMatrix4(this.inverse_matrix),this.field.calculateSignedDistance($.x,$.y,$.z)}}class Y extends D{constructor(t,s){super(),this.field=t,this.k=s/(t.bounding_box.max_z-t.bounding_box.min_z);const i=Math.min(t.bounding_box.min_x,t.bounding_box.min_y),e=Math.max(t.bounding_box.max_x,t.bounding_box.max_y);this.bounding_box=new n(i,i,t.bounding_box.min_z,e,e,t.bounding_box.max_z)}calculateSignedDistance(t,s,i){const e=Math.cos(i*this.k),h=Math.sin(i*this.k),n=t*e-s*h,m=t*h+s*e;return this.field.calculateSignedDistance(n,m,i)}}class Z extends D{constructor(t,s){super(),this.field=t,this.half_thickness=.5*s,this.bounding_box=t.bounding_box.clone().grow(this.half_thickness)}calculateSignedDistance(t,s,i){return Math.abs(this.field.calculateSignedDistance(t,s,i))-this.half_thickness}}class O extends D{constructor(t,s){super(),this.field=t,this.distance=s,this.bounding_box=t.bounding_box.clone().grow(this.distance)}calculateSignedDistance(t,s,i){return this.field.calculateSignedDistance(t,s,i)-this.distance}}class B extends D{constructor(t=[]){super(),this.fields=t,this.bounding_box=this.fields[0].bounding_box.clone();for(let t=1;t<this.fields.length;++t)this.bounding_box.union(this.fields[t].bounding_box)}calculateSignedDistance(t,s,i){let e=this.fields[0].calculateSignedDistance(t,s,i);for(let h=1;h<this.fields.length;++h)e=Math.min(e,this.fields[h].calculateSignedDistance(t,s,i));return e}}class I extends D{constructor(t=[]){super(),this.fields=t,this.bounding_box=this.fields[0].bounding_box.clone()}calculateSignedDistance(t,s,i){let e=this.fields[0].calculateSignedDistance(t,s,i);for(let h=1;h<this.fields.length;++h)e=Math.max(e,-this.fields[h].calculateSignedDistance(t,s,i));return e}}class T extends D{constructor(t=[]){super(),this.fields=t,this.bounding_box=this.fields[0].bounding_box.clone();for(let t=1;t<this.fields.length;++t)this.bounding_box.intersect(this.fields[t].bounding_box)}calculateSignedDistance(t,s,i){let e=this.fields[0].calculateSignedDistance(t,s,i);for(let h=1;h<this.fields.length;++h)e=Math.max(e,this.fields[h].calculateSignedDistance(t,s,i));return e}}class P extends D{constructor(t,s){super(),this.smoothness=t,this.fields=s,this.bounding_box=this.fields[0].bounding_box.clone();for(let t=1;t<this.fields.length;++t)this.bounding_box.union(this.fields[t].bounding_box)}calculateSignedDistance(t,s,i){let e=this.fields[0].calculateSignedDistance(t,s,i);for(let h=1;h<this.fields.length;++h){let n=this.fields[h].calculateSignedDistance(t,s,i),m=c(.5+.5*(n-e)/this.smoothness,0,1);e=n+(e-n)*m-this.smoothness*m*(1-m)}return e}}class C extends D{constructor(t,s){super(),this.smoothness=t,this.fields=s,this.bounding_box=this.fields[0].bounding_box.clone()}calculateSignedDistance(t,s,i){let e=this.fields[0].calculateSignedDistance(t,s,i);for(let h=1;h<this.fields.length;++h){let n=this.fields[h].calculateSignedDistance(t,s,i),m=c(.5-.5*(n+e)/this.smoothness,0,1);e=e+(-n-e)*m+this.smoothness*m*(1-m)}return e}}class U extends D{constructor(t,s){super(),this.smoothness=t,this.fields=s,this.bounding_box=this.fields[0].bounding_box.clone();for(let t=1;t<this.fields.length;++t)this.bounding_box.intersect(this.fields[t].bounding_box)}calculateSignedDistance(t,s,i){let e=this.fields[0].calculateSignedDistance(t,s,i);for(let h=1;h<this.fields.length;++h){let n=this.fields[h].calculateSignedDistance(t,s,i),m=c(.5-.5*(n-e)/this.smoothness,0,1);e=n+(e-n)*m+this.smoothness*m*(1-m)}return e}}const A=new g,L=new w,j=new m,N=new o,$=new i(0,0,0),G=[new z(0,0,0,0,0,0,0,0),new z(0,0,0,0,0,0,0,0),new z(0,0,0,0,0,0,0,0),new z(0,0,0,0,0,0,0,0),new z(0,0,0,0,0,0,0,0),new z(0,0,0,0,0,0,0,0),new z(0,0,0,0,0,0,0,0),new z(0,0,0,0,0,0,0,0),new z(0,0,0,0,0,0,0,0),new z(0,0,0,0,0,0,0,0),new z(0,0,0,0,0,0,0,0),new z(0,0,0,0,0,0,0,0)];exports.BoundingBox2=h,exports.BoundingBox3=n,exports.BoxFrameSignedDistanceField3=k,exports.BoxSignedDistanceField3=F,exports.BufferWriter=S,exports.CylinderSignedDistanceField3=q,exports.DifferenceSignedDistanceField3=I,exports.DifferenceSmoothSignedDistanceField3=C,exports.EPSILON=t,exports.INV_TWO_EPSILON=5e5,exports.IntersectionSignedDistanceField3=T,exports.IntersectionSmoothSignedDistanceField3=U,exports.Matrix2=a,exports.Matrix3=r,exports.Matrix4=o,exports.OffsetSignedDistanceField3=O,exports.Plane=m,exports.PlaneSignedDistanceField3=V,exports.PolygonIndices=class{constructor(t=[],s=new m,i=null){this.indices=t,this.plane=s,this.colour=i}},exports.PolygonMesh=class{constructor(t=[],s=[]){this.vertices=t,this.faces=s}},exports.SampleOctreeEmpty=w,exports.SampleOctreeFull=g,exports.SampleOctreeLeaf=f,exports.SampleOctreeMeshBuilder=b,exports.SampleOctreeRoot=M,exports.ShellSignedDistanceField3=Z,exports.SignedDistanceField3=D,exports.SphereSignedDistanceField3=v,exports.TorusSignedDistanceField3=E,exports.TransformSignedDistanceField3=X,exports.TriangleMesh=_,exports.TwistSignedDistanceField3=Y,exports.UnionSignedDistanceField3=B,exports.UnionSmoothSignedDistanceField3=P,exports.Vector2=s,exports.Vector3=i,exports.Vector4=e,exports.Vertex=u,exports.bestDivisibleGridSize=function(t,s,i,e){return x(t,s,i,Math.max(t,s,i)/e)},exports.box=function(t=20,s=20,i=20,e=0){return new F(t,s,i,e)},exports.boxFrame=function(t=20,s=20,i=20,e=5){return new k(t,s,i,e)},exports.clamp=c,exports.closestEvenlyDivisibleGridSize=x,exports.convertToOBJ=function(t){if(t instanceof _==0)throw new Error("input mesh must be a 'TriangleMesh'!");let s="";for(let i=0;i<t.vertices.length;++i){const e=t.vertices[i].position;s+=`v ${e.x}, ${e.y}, ${e.z}\n`}for(let i=0;i<t.indices.length;i+=3){s+=`f ${t.indices[i+0]+1}, ${t.indices[i+1]+1}, ${t.indices[i+2]+1}\n`}return s},exports.convertToSTL=function(t){if(t instanceof _==0)throw new Error("input mesh must be a 'TriangleMesh'!");const s=t.indices.length/3,i=new ArrayBuffer(84+50*s),e=new S(i);e.setOffset(80),e.writeUint32(s,!0);for(let s=0;s<t.indices.length;s+=3){const i=t.vertices[t.indices[s+0]].position,h=t.vertices[t.indices[s+1]].position,n=t.vertices[t.indices[s+2]].position;j.fromVectors(i,h,n),e.writeFloat32(j.normal_x,!0),e.writeFloat32(j.normal_y,!0),e.writeFloat32(j.normal_z,!0),e.writeFloat32(i.x,!0),e.writeFloat32(i.y,!0),e.writeFloat32(i.z,!0),e.writeFloat32(h.x,!0),e.writeFloat32(h.y,!0),e.writeFloat32(h.z,!0),e.writeFloat32(n.x,!0),e.writeFloat32(n.y,!0),e.writeFloat32(n.z,!0),e.writeUint16(0,!0)}return new Uint8Array(i)},exports.createSampleOctreeFromField=function(t,s,i,e=null){return new M(s.min_x,s.min_y,s.min_z,s.max_x,s.max_y,s.max_z,i).sampleSignedDistanceField(t,e)},exports.cylinder=function(t=10,s=1/0){return new q(t,s)},exports.difference=function(...t){return new I(t)},exports.differenceSmooth=function(t,...s){return new C(t,s)},exports.distanceFromOrigin=d,exports.distanceSquared=function(t,s,i,e,h,n){const m=e-t,a=h-s,r=n-i;return m*m+a*a+r*r},exports.gcf=l,exports.intersection=function(...t){return new T(t)},exports.intersectionSmooth=function(t,...s){return new U(t,s)},exports.lcm=function(t,s){return t*s/l(t,s)},exports.lerp=function(t,s,i){return(s-t)*i+t},exports.offset=function(t,s){return new O(t,s)},exports.plane=function(t=new m){return new V(t)},exports.shell=function(t,s){return new Z(t,s)},exports.smallestGridSize=function(t,s,i){return l(t,l(s,i))},exports.sphere=function(t=5){return new v(t)},exports.torus=function(t=20,s=5){return new E(t,s)},exports.transform=function(t,s=new o){return new X(t,s)},exports.triangulateSignedDistanceField=function(t,s=t.bounding_box,i=8,e=5e-4){const h=new M(s.min_x,s.min_y,s.min_z,s.max_x,s.max_y,s.max_z,i).sampleSignedDistanceField(t,e),n=new b;return n.processCell(h),n.getMesh()},exports.twist=function(t,s){return new Y(t,s)},exports.union=function(...t){return new B(t)},exports.unionSmooth=function(t,...s){return new P(t,s)};
